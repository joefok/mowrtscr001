// --- Add near other game state variables ---
let restarting = false;

// Auto-restart the game after a short delay
function gameOverRestart(delayMs = 1200) {
  if (restarting) return;          // avoid double triggers
  restarting = true;

  setText(diag, 'Game Over — restarting...');
  setText(lastGestureEl, 'game-over');

  // Stop soft drop & movement (DAS/ARR), clear smoothing buffer
  softDropActive = false;
  heldDir = 0; 
  nextMoveAt = 0;
  dxHistory.length = 0;

  // Clear board & reset score
  for (let r = 0; r < ROWS; r++) board[r].fill(0);
  score = 0; lines = 0; pieces = 0; updateHUD();

  // Clear active and redraw empty board
  active = null; 
  draw();

  // Fresh 7-bag and gravity timer baseline
  bag.length = 0; 
  refillBag();
  lastFallAt = performance.now();

  // Spawn again after a short pause
  setTimeout(() => {
    spawn();            // will start clean on empty board
    draw();
    setText(lastGestureEl, '—');
    setText(diag, MODE === 'hand'
      ? 'Ready (hand): Move=hold left/right, Rotate=pinch, Soft drop=index below wrist.'
      : 'Ready (pose): Move=hold wrist left/right, Rotate=wrist above nose, Soft drop=wrist below nose.'
    );
    restarting = false;
  }, delayMs);
}
